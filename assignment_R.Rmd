---
title: "assignment"
author: '10485437'
date: "15/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Loading Packages

Firstly, the relevant libraries must be loaded.

```{r, message=FALSE}
library(tidyverse)      # for tidying data
library(afex)           # for running anova
library(emmeans)        # for running pairwise comparisons
library(performance)    # for model assumptions
library(visdat)         # for visualising missing data
library(lme4)
library(lmerTest)
library(dplyr)          # for summarising data
library(ggplot2)
library(plotly)         # for interactive graphs
```

# QUESTION 1

## Loading the dataset

The data must be loaded and visualized.

```{r, message=FALSE}
Visual_data <- read_csv("assignment_dataset_1(1).csv")     

head(Visual_data)     
```

## Data Wrangling

Condition is a factor but is not currently read as factor by R. It therefore 
must be mutated to be read as a factor by R for appropriate analysis. This will
be coded onto a tidied data set. To make the data and analysis easier to read,
condition a is changed to 'visually_normal' and condition b is changed to be
called 'visually_degraded'.

```{r}
tidied_visual_data <- Visual_data %>%        
  mutate(condition = factor(condition)) %>%
  mutate(condition = recode(condition,
                            "condition_a" = "Visually_normal",
                            "condition_b" = "Visually_degraded"))
head(tidied_visual_data)
```


## Producing Descriptive Statistics

It is appropriate to generate descriptive statistics and plots to 
visualize the data. This will provide a preliminary idea of the effect the anova
may find.

```{r}
tidied_visual_data %>%
  group_by(condition) %>%  
  summarise(mean_response_time = mean(response_time),
            sd_response_time = sd(response_time))
```

Condition A (Normal visual quality) seems to have a faster response time, and 
therefore be pronounced at a faster rate than condition B (visually degraded 
words). However, there is overlap in the standard deviations. To see the 
relationship more clearly, a plot could help to visualize the potential effect 
in the data. 

```{r}
tidied_visual_data %>%
  mutate(condition = str_to_title(condition)) %>%
  ggplot(aes(x = condition, y = response_time, colour = condition)) +
  geom_violin() +                   
  geom_jitter(width = .1, alpha = .5) +
  stat_summary(fun.data = "mean_cl_boot", colour = "black") +
  guides(colour = FALSE) +
  labs(x = "Visual Quality",
       y = "Time taken to Pronounce Word (ms.)",
       title = "      Time taken to Pronounce words presented in different Visual 
                                           Qualities",
       caption = "Figure 1: Words of a visually degraded presentation appear to 
       induce slower pronunication times than normal visual 
       presentations of the same word") +
  theme_minimal()
```

The graph shows the visually degraded words to pronounced slightly slower than 
the normal visual quality words. This difference must be tested with an ANOVA.

## Conducting an ANOVA to investigate the difference in pronunciation response 
## time between normal and visually degraded words

### Building ANOVA model

To run an ANOVA, a model of the data must be produced for a between participant 
design.

```{r}
visual_model <- aov_4(response_time ~ condition + (1 | participant), 
                      data = tidied_visual_data)
```

### Interpretting the Model Output 

The summary() function can provide the output of the ANOVA from the visual_model

```{r}
summary(visual_model)
```

The ANOVA demonstrates a significant difference in the response time by 
participants, when pronouncing normal vs. visual degraded words. 


## Conducting Pairwise Analysis

The ANOVA identified a significant effect.But it is not clear from this analysis
what is driving the effect. Therefore, a pairwise comparison analysis is needed 
to clearly identify the driving effect.

```{r}
emmeans(visual_model, pairwise ~ condition)
```
Pairwise comparisons demonstrate the visually degraded words to be pronounced 
slower than normal words. 

## Results and Interpretation

A one way independent ANOVA was conducted to investigate the influence of the 
visual quality of a word representation, on how an quickly an individual can 
pronounce the word. The ANOVA revealed a significant effect of visual quality 
(F(1, 94) = 15.83, p = 0.0001, ηG2 = 0.144). This significant effect was 
interpreted using a Tukey-corrected pairwise comparison.  This comparison 
revealed the significant effect was driven by visual normal words being 
pronounced at a faster rate than visually degraded words (1002 ms. vs. 1020 ms.,
t(94) = 3.98, p = 0.0001).

# Question 2
## Question 2a: Conducting an ANCOVA to determine and interpret the effect of 
## visual quality on response time when taking account of caffeine consumption

## Loading data 

Firstly, the data must be loaded and visualized. 

```{r message=FALSE}
caffeine_data <- read_csv("assignment_dataset_2(1).csv")  

head(caffeine_data)                   
```
From looking at the first 6 rows of data, it is clear that the condition (visual
quality) and caffeine consumption, are not being viewed as factors by R. This 
must be changed with some data wrangling. 

## Data wrangling 

Using the mutate function, condition can be changed to be viewed as a factor
in R. This will be coded onto a tidied data set. We can then visualise the data 
to see the new data set.

```{r}
tidied_caffeine_data <- caffeine_data %>%   
  mutate(condition = factor(condition)) %>%
    mutate(condition = recode(condition,
                            "condition_a" = "Visually_normal",
                            "condition_b" = "Visually_degraded")) %>%
  rename(Caffeine = caffeine, Response_Time = response_time, 
         Condition = condition)


head(tidied_caffeine_data)                   
```
## Generating descriptive statistics

Now to generate descriptive statistics i.e. mean and standard deviation

```{r}
tidied_caffeine_data %>%
  group_by(Condition, Caffeine) %>% 
  summarise(Mean_Response_Time = mean(Response_Time),
            sd_Response_Time = sd(Response_Time))
```


```{r}
tidied_caffeine_data %>%
  group_by(Condition, Caffeine) %>%
  summarise (n())
```

It is clear that condition b does not have participants with 0 caffeine 
consumption like condition a. Further, condition a has not been tested with 5 
and 6 cups of coffee like condition b. Therefore 0, 5 and 6 cups of coffee 
conditions must be removed as they have no counterpart in the other condition - 
each participant who had 0, 5 or 6 cups of coffee will be individually removed.
We can then visualize all conditions that have a counterpart in both condition a
and b.
```{r}
tidied_caffeine_data1 <- tidied_caffeine_data [-c(8, 18, 21, 23, 26, 29, 43, 46,
                                                  54, 56, 70, 73, 76, 87, 90, 
                                                  95), ]
tidied_caffeine_data1 %>%
  group_by(Condition, Caffeine) %>%
  summarise (n())

tidied_caffeine_data1 %>%
  group_by(Condition, Caffeine) %>% 
  summarise(Mean_Response_Time = mean(Response_Time),
            sd_Response_Time = sd(Response_Time))
```

```{r}
tidied_caffeine_data1 %>%
  group_by(Condition) %>% 
  summarise(Mean_Response_Time = mean(Response_Time),
            sd_Response_Time = sd(Response_Time))
```

Now the data has been further tidied, it can be presented in a figure to 
visualise potential relationships. Hovering the cursor over each data point will
present the parameters of that data point, including caffeine consumption, 
response time and visual quality of word presentation (represented as 
Condition). Clicking on either visual quality variable within the legend will 
remove it from the graph - this isolates a view of the response time in one 
visual quality condition when taking into account caffeine consumption e.g. only
looking at response time to visually degraded words when taking caffeine 
consumption into account. Re-clicking the variable will return it to view.

```{r}
graph2 <- tidied_caffeine_data1 %>%
  ggplot(aes(x = Caffeine, y = Response_Time)) +
  geom_point(aes(colour = Condition), size = 3, shape = 10, alpha = .4) +
  theme(text = element_text(size = 14)) +
  theme_minimal() +
  theme(legend.position="bottom") +
  labs(x = "Caffeine Consumption",
       y = "Response Time (ms.)", 
       colour = "Condition",
       title = "Response Time to pronunciate words of different Visual Quality
              whilst considering caffeine consumption")

ggplotly(graph2)
```

This presents a potentially weak relationship between caffeine consumption and 
response time, in that the more caffeine that is consumed the higher the 
response time becomes. Faster response times lie within less caffeine 
consumption.

Further, condition a (visually normal presentations) are clustered within the
lower caffeine consumption with lower response times. This contrasts with the 
condition b participants (visually degraded presentations) who are clustered 
within higher caffeine consumption and higher response times (slower responses).

The data points follow a weak relationship so an ANCOVA needs to be conducted to
see if the effect is significant. So the influence of the quality of visual 
representation on pronunciation time, may be co-influenced by coffee 
consumption.

## Building models for ANCOVA

Firstly, we can use the model built in question1 to model the effect of 
condition on response time (the visual_model). We know from question 1 that this
has a significant F value and minuscule P value, and pairwise comparisons 
demonstrated the visually degraded presentations to be pronounced at a slower 
rate than words presented with normal visual quality.

We then build an ANCOVA model with the co-variate of caffeine consumption. The
factorize parameter is set to FALSE so that caffeine is not treated as an
experimental factor but as a continuous predictor.

```{r}
caffeine_model <- aov_4(Response_Time ~ Caffeine + Condition + (1 | participant)
                        , data = tidied_caffeine_data1, factorize = FALSE)

anova(caffeine_model)
```

This output suggests we still have a significant effect of condition even when
accounting for caffeine consumption (F(1,77) = 4.6382, p = 0.03)

Using the emmeans function, we can see the adjusted means of the conditions. 

```{r}
emmeans(caffeine_model, pairwise ~ Condition)
```

## Question 2b: Producing a linear regression model of the data for comparison

First we must check how the conditions are coded in terms of their contrasts.

```{r}
contrasts(tidied_caffeine_data1$Condition)
```


## Building ANOVA as linear regression model

```{r}
visual_model_lm <- lm(Response_Time ~ Condition, data = tidied_caffeine_data1)
visual_model_lm
```

Using the equation and coding for the visually normal condition(0,1):

Response Time = Intercept + β1(visually degraded)
Response Time = 1001.35 + 15.78(0)
Response Time = 1001.35 for visually normal word pronunciation times.

The same equation and coding for the visually degraded condition(1,0):

Response Time = Intercept + β1(visually degraded)
Response Time = 1001.35 + 15.78(1)
Response Time = 1017.13 for visually degraded pronunciation times.

This linear model provides the same mean outcomes as the anova.

##Building ANCOVA as linear regression model

```{r}
caffeine_model_ancova <- lm(Response_Time ~ Caffeine + Condition, 
                            data = tidied_caffeine_data1)
caffeine_model_ancova
```
```{r}
mean(tidied_caffeine_data1$Caffeine)
```
Now caffeine has been accounted for, it can be added into the equation.

Response Time = Intercept + β1(caffeine) + β2(visually degraded)
Response Time = 1000.4383 + 0.5136(2.55) + 14.989(0)
Response Time = 1001.75

Response Time = Intercept + β1(caffeine) + β2(visually degraded)
Response Time = 1000.4383 + 0.5136(2.55) + 14.989(1)
Response Time = 1016.73
# Question 3

## Loading data

Firstly, the data needs to be loaded and visualized using the head function.

```{r}
priming_data <- read.csv("assignment_dataset_3(1).csv")

head(priming_data)
```
The conditions are not being read as factors by R, this needs to be changed.

## Data Wrangling 

R must read the data in a long format for our analysis, it is currently in a 
wide format. The data can be reshaped using the pivot_longer() function. The 
condition column must then be separated into "Prime" and "Target"- this will 
enable us to carry out the experimental 2x2 repeated measures design. Prime and 
Target must be changed to be read as factors by R.

```{r}
longer_priming_data <- priming_data %>%
  pivot_longer(cols = c(positiveprime_positivetarget, 
                        positiveprime_negativetarget, 
                        negativeprime_positivetarget, 
                        negativeprime_negativetarget), 
               names_to = "Condition", 
               values_to = "RT")

tidied_priming_data <- longer_priming_data %>% 
  mutate(Condition = recode(Condition,
                            "1" = "positiveprime_positivetarget",
                            "2" = "positiveprime_negativetarget", 
                            "3" = "negativeprime_positivetarget", 
                            "4" = "negativeprime_positivetarget")) %>%
  separate(col = "Condition", into = c("Prime", "Target"), sep = "_") %>%
  mutate(Prime = factor(Prime), Target = factor(Target))

head(tidied_priming_data)
```


## Producing descriptive statistics

Now to produce descriptive statistics to picture the possible effect in the 
data.

```{r}
tidied_priming_data %>%
  group_by(Prime, Target) %>%
  summarise(mean_RT = mean(RT), sd_RT = sd(RT))
```

It appears that the positive primes respond faster to positive and negative
images following a positive prime, relative to a negative prime. Further, a 
positive prime followed by a positive target provides a faster response time
than a positive prime and negative target. There appears to be no difference
in response time when a negative or positive target is preceded by a negative 
prime.

A graph will present this trend in a more clearer picture. 

```{r}
tidied_priming_data %>%
  ggplot(aes(x = Prime:Target, y = RT, colour = Prime:Target)) +
  geom_violin() +
  geom_jitter(width = .1, alpha = .25) +
  guides(colour = FALSE) +
  stat_summary(fun.data = "mean_cl_boot", colour = "black") +
  theme_minimal() +
  theme(text = element_text(size = 10)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = .5)) +
  labs(x = "Prime X Target", y = "RT (ms)", 
  title = "Response time to Target images when Prime images are of the same or 
                                              different Valence")
```

## Conducting ANOVA

Now to build our ANOVA model for the 2x2 repeated measures design, and run an
ANOVA.

```{r}
prime_model <- aov_4(RT ~ Prime * Target + (1 + Prime * Target | participant), 
                     data = tidied_priming_data, na.rm = TRUE)

anova(prime_model)
```

The main effects of Prime (F(1,147) = 0.31, p = 0.58) and Target 
(F(1,147) = 0.24, p = 0.63)are not significant. However, the interaction 
between the target and prime format is significant (F(1,147) = 17.18, p < .001).
Therefore, conducting pairwise comparisons could identify what condition allows
the significant interaction effect. 

```{r}
emmeans(prime_model, pairwise ~ Prime * Target, adjust = "none")
```

The pairwise comparisons demonstrate that the response time of a participant
is much faster when the prime and the target are of the same valence, relative
to when the prime and target are of different valence. For instance, 
participants responded faster to a positive target following a positive prime, 
relative to a negative prime (t(147) = 2.906, p = .0042). Similarly, 
participants responded faster to a negative target following a negative prime, 
relative to a positive prime (t(147) = 3.132, p = .0021). 

Therefore, on their own a negative priming image could not elicit a faster 
response relative to a positive priming image succeeded by a neutral image. 
However, when the target image is of the same valence as the prime image, a 
significant interaction effect occurs such that it will elicit a faster response
time from participants. 
